{
  "name": "get_report_yandex_metrica_sync",
  "description": "Формирует отчёт из Яндекс.Метрики (Reports API) в синхронном режиме и возвращает результат в виде строки (CSV или JSON). Функция автоматически оптимизирует выгрузку: разбивает длинные периоды на месяцы/кварталы, обрабатывает пагинацию данных",
  "parameters": {
    "type": "object",
    "properties": {
      "ids": {
        "type": "string",
        "description": "ID счётчика Яндекс.Метрики (ОБЯЗАТЕЛЬНЫЙ). Чтобы найти ID: зайдите в Яндекс.Метрику → Настройки → Список счётчиков. ID показан в интерфейсе и в URL: https://metrika.yandex.ru/dashboard?id=12345678"
      },
      "date1": {
        "type": "string",
        "description": "Начальная дата периода в формате ГГГГ-ММ-ДД (например, 2024-09-01). Если пользователь указал только месяц или год - вычисли конкретные даты"
      },
      "date2": {
        "type": "string",
        "description": "Конечная дата периода в формате ГГГГ-ММ-ДД (например, 2024-09-30). Если пользователь сказал 'за последние 7 дней' - рассчитай текущую дату минус 7 дней"
      },
      "metrics": {
        "type": "string",
        "description": "Метрики (цифровые показатели) через запятую. Основные: ym:s:visits (визиты), ym:s:users (пользователи), ym:s:pageviews (просмотры). Дополнительные: ym:s:bounceRate (отказы), ym:s:pageDepth (глубина просмотра), ym:s:avgVisitDurationSeconds (время на сайте). ЕСЛИ ПОЛЬЗОВАТЕЛЬ НЕ УКАЗАЛ - СПРОСИ КОНКРЕТНЫЕ МЕТРИКИ"
      },
      "dimensions": {
        "type": "string",
        "description": "Группировки (по каким параметрам разбивать данные) через запятую. Основные: ym:s:date (по дням), ym:s:regionCountry (по странам), ym:s:regionCityName (по городам), ym:s:deviceCategory (по устройствам), ym:s:trafficSource (по источникам трафика). ЕСЛИ НЕ ЯСНО - СПРОСИ ПО КАКОМУ ПАРАМЕТРУ ГРУППИРОВАТЬ"
      },
      "filters": {
        "type": "string",
        "description": "Фильтрация данных. МОЖНО фильтровать только по измерениям (dimensions), НЕ по метрикам. Примеры: ym:s:regionCityName=='Москва' (только Москва), ym:s:deviceCategory=='mobile' (только мобильные). ВАЖНО: для стран (ym:s:regionCountry) фильтрация работает ТОЛЬКО по числовым идентификаторам регионов (например, Россия=225, Беларусь=149, Украина=187, США=84, Польша=50). Если пользователь указывает название страны, необходимо перевести его в числовой код, используя справочник регионов Яндекс.Метрики. Например, 'Россия' должно быть преобразовано в '225'. Если пользователь хочет фильтровать по метрикам, объясните, что это невозможно."
      },
      "preset": {
        "type": "string",
        "description": "Готовый предустановленный отчёт для быстрого старта. Используй если пользователь не указал метрики/измерения. Варианты: traffic (общий трафик), sources (источники), geo (география), devices (устройства), demographics (демография). ЕСЛИ ЗАДАНЫ METRICS И DIMENSIONS - PRESET ИГНОРИРУЕТСЯ",
        "enum": ["traffic", "sources", "geo", "devices", "demographics"]
      },
      "sort": {
        "type": "string",
        "description": "Сортировка результатов. Примеры: -ym:s:visits (по убыванию визитов), ym:s:date (по возрастанию даты). МОЖНО УКАЗЫВАТЬ ТОЛЬКО ПОЛЯ, КОТОРЫЕ ПРИСУТСТВУЮТ В METRICS ИЛИ DIMENSIONS"
      },
      "lang": {
        "type": "string",
        "description": "Язык интерфейса для названий параметров",
        "enum": ["ru", "en"],
        "default": "ru"
      },
      "token": {
        "type": "string",
        "description": "OAuth-токен для доступа к приватным счётчикам. Если не указан, используется переменная окружения YANDEX_METRIKA_TOKEN. ЕСЛИ СЧЁТЧИК ПРИВАТНЫЙ И ТОКЕН НЕ УКАЗАН - ОШИБКА АВТОРИЗАЦИИ"
      },
      "timeout": {
        "type": "integer",
        "description": "Общий лимит времени выполнения функции в секундах (по умолчанию 30). Все подзапросы делят этот лимит; если он исчерпан - выполнение прерывается",
        "default": 30
      },
      "batch_size": {
        "type": "integer",
        "description": "Лимит строк на страницу (по умолчанию 5000). API возвращает максимум batch_size строк за один запрос; для больших выборок используется offset",
        "default": 5000
      },
      "max_rows": {
        "type": "integer",
        "description": "Максимальное количество строк для выгрузки (по умолчанию 10000). Даже при использовании offset общее количество строк может быть ограничено самим API",
        "default": 10000
      },
      "output_format": {
        "type": "string",
        "description": "Формат результата: csv (для Excel и таблиц) или json (для разработчиков и интеграций)",
        "enum": ["csv", "json"],
        "default": "csv"
      }
    },
    "required": ["ids", "date1", "date2"]
  }
}